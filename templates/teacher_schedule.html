{% extends "base.html" %}
{% block title %}Manage Schedule{% endblock %}

{% block content %}
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
        <li class="breadcrumb-item active">Manage Schedule</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Class Schedule</h2>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addScheduleModal">
        <i class="bi bi-calendar-plus me-1"></i>Add Schedule
    </button>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">Filter by Course</h6>
            </div>
            <div class="card-body">
                <select class="form-select" id="courseFilter">
                    <option value="">All Courses</option>
                    {% for course in courses %}
                    <option value="{{ course.id }}">{{ course.course_code }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    <div class="col-md-9">
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">Current Week: {{ current_week }}</h6>
            </div>
            <div class="card-body">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary">
                        <i class="bi bi-arrow-left"></i> Previous Week
                    </button>
                    <button type="button" class="btn btn-outline-secondary">Current Week</button>
                    <button type="button" class="btn btn-outline-primary">
                        Next Week <i class="bi bi-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="card-title mb-0">Weekly Schedule</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered schedule-table">
                <thead>
                    <tr class="table-primary">
                        <th style="width: 10%">Time</th>
                        <th style="width: 18%">Monday</th>
                        <th style="width: 18%">Tuesday</th>
                        <th style="width: 18%">Wednesday</th>
                        <th style="width: 18%">Thursday</th>
                        <th style="width: 18%">Friday</th>
                    </tr>
                </thead>
                <tbody>
                    {% for time_slot in time_slots %}
                    <tr>
                        <td class="fw-bold">{{ time_slot }}</td>
                        {% for day in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'] %}
                        <td class="schedule-cell" data-day="{{ day }}" data-time="{{ time_slot }}">
                            {% for schedule in schedules %}
                                {% if schedule.day == day and schedule.time_slot == time_slot %}
                                <div class="schedule-item bg-info text-white p-2 rounded mb-1">
                                    <div class="fw-bold">{{ schedule.course_code }}</div>
                                    <small>{{ schedule.room }}</small>
                                    <div class="mt-1">
                                        <button class="btn btn-sm btn-light me-1" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#editScheduleModal"
                                                data-schedule-id="{{ schedule.id }}">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <button class="btn btn-sm btn-light">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                            <button class="btn btn-sm btn-outline-secondary w-100 add-schedule-btn"
                                    data-day="{{ day }}" 
                                    data-time="{{ time_slot }}">
                                <i class="bi bi-plus"></i> Add Class
                            </button>
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Schedule Modal -->
<div class="modal fade" id="addScheduleModal" tabindex="-1" aria-labelledby="addScheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addScheduleModalLabel">Add Class Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addScheduleForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="schedule_course" class="form-label">Course</label>
                            <select class="form-select" id="schedule_course" name="course_id" required>
                                <option value="">Select Course</option>
                                {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.course_code }} - {{ course.course_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="schedule_day" class="form-label">Day</label>
                            <select class="form-select" id="schedule_day" name="day" required>
                                <option value="">Select Day</option>
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="schedule_time" class="form-label">Time Slot</label>
                            <select class="form-select" id="schedule_time" name="time_slot" required>
                                <option value="">Select Time</option>
                                {% for time_slot in time_slots %}
                                <option value="{{ time_slot }}">{{ time_slot }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="schedule_room" class="form-label">Room</label>
                            <input type="text" class="form-control" id="schedule_room" name="room" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="schedule_duration" class="form-label">Duration (minutes)</label>
                        <input type="number" class="form-control" id="schedule_duration" name="duration" value="60" min="30" max="180" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addSchedule()">Add Schedule</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Schedule Modal -->
<div class="modal fade" id="editScheduleModal" tabindex="-1" aria-labelledby="editScheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editScheduleModalLabel">Edit Class Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editScheduleForm">
                    <input type="hidden" id="edit_schedule_id" name="schedule_id">
                    <!-- Form content same as add schedule form -->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateSchedule()">Update Schedule</button>
                <button type="button" class="btn btn-danger" onclick="deleteSchedule()">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
// Add event listeners to "Add Class" buttons
document.querySelectorAll('.add-schedule-btn').forEach(button => {
    button.addEventListener('click', function() {
        const day = this.getAttribute('data-day');
        const time = this.getAttribute('data-time');
        
        document.getElementById('schedule_day').value = day;
        document.getElementById('schedule_time').value = time;
        
        var modal = new bootstrap.Modal(document.getElementById('addScheduleModal'));
        modal.show();
    });
});

// Set schedule ID when edit modal is shown
document.getElementById('editScheduleModal').addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget;
    var scheduleId = button.getAttribute('data-schedule-id');
    document.getElementById('edit_schedule_id').value = scheduleId;
    
    // Here you would load the existing schedule data
    // For now, we'll just show a message
    console.log('Loading schedule data for ID:', scheduleId);
});

function addSchedule() {
    // Implement add schedule functionality
    alert('Add schedule functionality would be implemented here');
    // Close modal
    var modal = bootstrap.Modal.getInstance(document.getElementById('addScheduleModal'));
    modal.hide();
}

function updateSchedule() {
    // Implement update schedule functionality
    alert('Update schedule functionality would be implemented here');
    // Close modal
    var modal = bootstrap.Modal.getInstance(document.getElementById('editScheduleModal'));
    modal.hide();
}

function deleteSchedule() {
    if (confirm('Are you sure you want to delete this schedule?')) {
        // Implement delete schedule functionality
        alert('Delete schedule functionality would be implemented here');
        // Close modal
        var modal = bootstrap.Modal.getInstance(document.getElementById('editScheduleModal'));
        modal.hide();
    }
}
</script>

<style>
.schedule-table td {
    height: 80px;
    vertical-align: top;
}

.schedule-cell {
    position: relative;
    min-height: 80px;
}

.schedule-item {
    font-size: 0.85rem;
}

.add-schedule-btn {
    opacity: 0.3;
    transition: opacity 0.2s;
}

.schedule-cell:hover .add-schedule-btn {
    opacity: 1;
}
</style>
{% endblock %}